{"ast":null,"code":"import auth0 from '../api/utils/auth0';\nimport { table } from '../api/utils/Airtable.js';\n\nconst ownsRecord = handler => async (req, res) => {\n  const {\n    user\n  } = await auth0.getSession(req);\n\n  if (!user) {\n    res.statusCode = 401;\n    return res.json({\n      msg: 'Not logged in'\n    });\n  }\n\n  const {\n    id\n  } = req.body;\n\n  try {\n    const existingRecord = await table.find(id);\n\n    if (!existingRecord || user.sub !== existingRecord.fields.userId) {\n      res.statusCode = 404;\n      return res.json({\n        msg: 'Record not found'\n      });\n    }\n\n    req.record = existingRecord;\n    return handler(req, res);\n  } catch (err) {\n    console.error(err);\n    res.statusCode = 500;\n    return res.json({\n      msg: 'Something went wrong'\n    });\n  }\n};\n\nexport default ownsRecord;","map":{"version":3,"sources":["C:/Users/kshan/Desktop/Web dev projects/subscriptions_tracker/pages/middleware/OwnsRecord.js"],"names":["auth0","table","ownsRecord","handler","req","res","user","getSession","statusCode","json","msg","id","body","existingRecord","find","sub","fields","userId","record","err","console","error"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,oBAAlB;AACA,SAASC,KAAT,QAAsB,0BAAtB;;AACA,MAAMC,UAAU,GAAIC,OAAD,IAAa,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAChD,QAAM;AAAEC,IAAAA;AAAF,MAAW,MAAMN,KAAK,CAACO,UAAN,CAAiBH,GAAjB,CAAvB;;AAEA,MAAI,CAACE,IAAL,EAAW;AACPD,IAAAA,GAAG,CAACG,UAAJ,GAAiB,GAAjB;AACA,WAAOH,GAAG,CAACI,IAAJ,CAAS;AAAEC,MAAAA,GAAG,EAAE;AAAP,KAAT,CAAP;AACH;;AAED,QAAM;AAAEC,IAAAA;AAAF,MAASP,GAAG,CAACQ,IAAnB;;AACA,MAAI;AACA,UAAMC,cAAc,GAAG,MAAMZ,KAAK,CAACa,IAAN,CAAWH,EAAX,CAA7B;;AACA,QAAI,CAACE,cAAD,IAAmBP,IAAI,CAACS,GAAL,KAAaF,cAAc,CAACG,MAAf,CAAsBC,MAA1D,EAAkE;AAC9DZ,MAAAA,GAAG,CAACG,UAAJ,GAAiB,GAAjB;AACA,aAAOH,GAAG,CAACI,IAAJ,CAAS;AAAEC,QAAAA,GAAG,EAAE;AAAP,OAAT,CAAP;AACH;;AACDN,IAAAA,GAAG,CAACc,MAAJ,GAAaL,cAAb;AACA,WAAOV,OAAO,CAACC,GAAD,EAAMC,GAAN,CAAd;AACH,GARD,CAQE,OAAOc,GAAP,EAAY;AACVC,IAAAA,OAAO,CAACC,KAAR,CAAcF,GAAd;AACAd,IAAAA,GAAG,CAACG,UAAJ,GAAiB,GAAjB;AACA,WAAOH,GAAG,CAACI,IAAJ,CAAS;AAAEC,MAAAA,GAAG,EAAE;AAAP,KAAT,CAAP;AACH;AACJ,CAtBD;;AAwBA,eAAeR,UAAf","sourcesContent":["import auth0 from '../api/utils/auth0';\r\nimport { table } from '../api/utils/Airtable.js';\r\nconst ownsRecord = (handler) => async (req, res) => {\r\n    const { user } = await auth0.getSession(req);\r\n\r\n    if (!user) {\r\n        res.statusCode = 401;\r\n        return res.json({ msg: 'Not logged in' });\r\n    }\r\n\r\n    const { id } = req.body;\r\n    try {\r\n        const existingRecord = await table.find(id);\r\n        if (!existingRecord || user.sub !== existingRecord.fields.userId) {\r\n            res.statusCode = 404;\r\n            return res.json({ msg: 'Record not found' });\r\n        }\r\n        req.record = existingRecord;\r\n        return handler(req, res);\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.statusCode = 500;\r\n        return res.json({ msg: 'Something went wrong' });\r\n    }\r\n};\r\n\r\nexport default ownsRecord;"]},"metadata":{},"sourceType":"module"}